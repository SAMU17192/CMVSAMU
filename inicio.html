<html>
<head>
 <meta charset="utf-8">
<link rel="stylesheet" type="text/css" href="css/bootstrap.css">
<link rel="stylesheet" type="text/css" href="bulma/css/bulma.css">
<link rel="stylesheet" type="text/css" href="font/css/fontawesome-all.css">
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="js/bootstrap.js"></script>
<script type="text/javascript" src="js/geturi.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="select/css/normalize.css" />
 	<link rel="stylesheet" type="text/css" href="css/estilo.css">
    <link rel="stylesheet" type="text/css" href="select/css/cs-select.css" />
    <link rel="stylesheet" type="text/css" href="select/css/cs-skin-rotate.css" />
    <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/animate.css@3.5.2/animate.min.css"
    integrity="sha384-OHBBOqpYHNsIqQy8hL1U+8OXf9hH6QRxi0+EODezv82DfnZoV7qoHAZDwMwEJvSw"
    crossorigin="anonymous">
    <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css"
    integrity="sha384-OHBBOqpYHNsIqQy8hL1U+8OXf9hH6QRxi0+EODezv82DfnZoV7qoHAZDwMwEJvSw"
    crossorigin="anonymous">
    <script type="text/javascript">
    	$(document).ready(function(){
    		var id = getUrlVars()["id"];
    		 $.ajax({
              url: 'http://127.0.0.1/TCC/webservice.php',
			        method: "POST",
			        data: {"tipo" : "listakm", "id" : id},
              success: function(data) {                               		
              	 var json = $.parseJSON(data);
              	 $("#kminicial").val(json.kmveiculo +' Km');            	               	 
              },              
              timeout: 3000,    
              error: function(){
	    		alert("Erro ao fazer a requisição");
  			  }              
		});
         
    	});
    </script>
  <title></title>
</head>
<body>
<nav class=" nav justify-content-center navbar navbar-expand-lg navbar-light bg-danger">
<ul class="nav justify-content-center">
  <li class="nav-item">
  <a class="navbar-brand" style="color:white;padding-top: 0.6rem;"><i class="animated bounceInLeft slower fas fa-ambulance" style="font-size:1.5rem;"></i> <b>CMV-SAMU</b></a>
</li>
</ul>
</nav>
<br>
<br>
<br>
<div class="animated zoomInDown card" style="margin: 2rem 2rem 2rem 2rem;">
<div class="card-body">
<div class="input-group">
  <div class="input-group-prepend">
    <span class="input-group-text bg-danger" style="color:#fff;text-align:center;">Km Inicial:</span>
  </div>
  <input type="text" class="form-control" id="kminicial" name="kminicial" style="text-align:center; " readonly>
  </div>
  <br>
  <div class="input-group">
  <div class="input-group-prepend">
    <span class="input-group-text bg-danger" style="color:#fff;text-align:center;">Km Final:</span>
</div>
  <input type="number" class="form-control" id="kmfinal" name="kmfinal">
</div>
<br>
  <div class="input-group" id="texto" style="display:none; ">
  <div class="input-group-prepend">
    <span class="input-group-text bg-danger" id="texto" style="color:#fff;text-align:center;">Km Rodados:</span>
</div>
  <input type="text" class="form-control" id="kmrodados" name="kmrodados" readonly value="" style="text-align:center; ">
</div>
<center><br><button type="button" class="btn btn-danger btn-lg" style="display: none;" id="btnat">Atualizar</button></center>
<buttonstyle style="display: none;" id="btnat"></button>
</div>
</div>
<script type="text/javascript">
  var kmg;
  $("#kmfinal").keyup(function(){    
    var kmf = parseFloat($("#kmfinal").val());
    var kmi = parseFloat($("#kminicial").val());
    var km; 
    var qtd = kmf.length;
    $('#kmrodados').val('0 Km');
    $('#btnat').hide();
    if(kmf>kmi){  
     $('#texto').show();
     $('#btnat').show();
     km  = kmf - kmi;
     kmg  = kmf - kmi;
      $("#kmrodados").val(km+" Km");
    }
    else
    {
     $("#kmrodados").val(); 
    }
  });
  $("#btnat").click(function(){    
    var id = getUrlVars()["id"];
    
         $.ajax({
              url: 'http://127.0.0.1/TCC/webservice.php',
              method: "POST",
               data: {"tipo" : "atualizarkm", "id" : id, "km" : kmg},
              success: function(data) {                                   
                alert("Atualizado"); 
                window.location.reload();         
              },              
              timeout: 3000,    
              error: function(){
          alert("Erro ao fazer a requisição");
          }              
    });
         });

</script>
<footer class="footer bg-danger" >
      <div class="content has-text-centered">
      <div class="row">
          <div class="col md-4 " style="">
            <strong style="color:white;">Alex</strong>
          </div>
          <div class="col md-4">
            <strong style="color:white;">Gustavo</strong>
          </div>
          <div class="col md-4">
            <strong style="color:white;">Samuel</strong>
          </div>
        </div> 
    </div>
  </footer>
</body>
</html>