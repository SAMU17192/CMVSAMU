<html>
<head>
 <meta charset="utf-8">
<link rel="stylesheet" type="text/css" href="css/bootstrap.css">
<link rel="stylesheet" type="text/css" href="bulma/css/bulma.css">
<link rel="stylesheet" type="text/css" href="font/css/fontawesome-all.css">
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="js/bootstrap.js"></script>
<script type="text/javascript" src="js/geturi.js"></script>

<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="select/css/normalize.css" />
 	<link rel="stylesheet" type="text/css" href="css/estilo.css">
    <link rel="stylesheet" type="text/css" href="select/css/cs-select.css" />
    <link rel="stylesheet" type="text/css" href="select/css/cs-skin-rotate.css" />
    <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/animate.css@3.5.2/animate.min.css"
    integrity="sha384-OHBBOqpYHNsIqQy8hL1U+8OXf9hH6QRxi0+EODezv82DfnZoV7qoHAZDwMwEJvSw"
    crossorigin="anonymous">
    <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css"
    integrity="sha384-OHBBOqpYHNsIqQy8hL1U+8OXf9hH6QRxi0+EODezv82DfnZoV7qoHAZDwMwEJvSw"
    crossorigin="anonymous">
    <script type="text/javascript">
    	$(document).ready(function(){
    		var id = getUrlVars()["id"];
    		 $.ajax({
              url: 'http://127.0.0.1/TCC/webservice.php',
			        method: "POST",
			        data: {"tipo" : "listakm", "id" : id},
              success: function(data) {                               		
              	 var json = $.parseJSON(data);
              	 $("#kminicial").val(json.KmVeiculo +' Km');            	               	 
              },              
              timeout: 3000,    
              error: function(){
	    		alert("Erro ao fazer a requisição");
  			  }              
		});

         
    	});
    </script>
  <title></title>
</head>
<body>
<nav class=" nav justify-content-center navbar navbar-expand-lg navbar-light bg-danger">
<ul class="nav justify-content-center">
  <li class="nav-item">
  <a class="navbar-brand" style="color:white;padding-top: 0.6rem;"><i class="animated bounceInLeft slower fas fa-ambulance" style="font-size:1.5rem;"></i> <b>CMV-SAMU</b></a>
</li>
</ul>
</nav>
<br>
<br>
<div class="card" id="listar" style="display:none;margin: 2rem 2rem 2rem 2rem;">
  <div class="table table-responsive table-dark">
  <table class="table">
    <thead>
    <tr>
      <th scope="col">#</th>
      <th scope="col">First</th>
      <th scope="col">Last</th>
      <th scope="col">Handle</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th scope="row">1</th>
      <td>Mark</td>
      <td>Otto</td>
      <td>@mdo</td>
    </tr>
    <tr>
      <th scope="row">2</th>
      <td>Jacob</td>
      <td>Thornton</td>
      <td>@fat</td>
    </tr>
    <tr>
      <th scope="row">3</th>
      <td colspan="2">Larry the Bird</td>
      <td>@twitter</td>
    </tr>
  </tbody>
  </table>
</div>
<div class="card-body">
</div>
</div>


<div class="" id="atualizar" style="margin: 2rem 2rem 2rem 2rem;">
<div class="card-body">

  <br>
<div class="input-group">
  <div class="input-group-prepend">
    <span class="input-group-text bg-danger" style="color:#fff;text-align:center;">Km Inicial:</span>
  </div>
  <input type="text" class="form-control" id="kminicial" name="kminicial" style="text-align:center; " readonly>
  </div>
  <br>

  <div class="input-group">
  <div class="input-group-prepend">
    <span class="input-group-text bg-danger" style="color:#fff;text-align:center;">Km Final:</span>
</div>
  <input type="number" class="form-control" id="kmfinal" name="kmfinal">
</div>

<br>
<div id="alert" class="alert alert-danger bg-danger" role="alert" style="display:none;text-align:center;color:#fff;">
  Atualizado Com Sucesso
</div>
<br>

  <div class="input-group" id="texto" style="display:none; ">
  <div class="input-group-prepend">
    <span class="input-group-text bg-danger" style="color:#fff;text-align:center;">Km Rodados:</span>
</div>
  <input type="text" class="form-control" id="kmrodados" name="kmrodados" readonly value="" style="text-align:center; ">
</div>
<center><br><button type="button" class="btn btn-danger btn-lg" style="display: none;" id="btnat">Atualizar</button></center>

</div>
</div>
<script type="text/javascript">
  var kmg;
  var kmf;
  $("#kmfinal").keyup(function(){    
    kmf = parseFloat($("#kmfinal").val());
    var kmi = parseFloat($("#kminicial").val());
    var km; 
    var qtd = kmf.length;
    $('#kmrodados').val('0 Km');
    $('#btnat').hide();
    if(kmf>kmi){  
     $('#texto').show();
     $('#btnat').show();
     km  = kmf - kmi;
     kmg  = kmf - kmi;
      $("#kmrodados").val(km+" Km");
    }
    else
    {
     $("#kmrodados").val(); 
    }
  });
  $("#btnat").click(function(){    
    var id = getUrlVars()["id"];
    
         $.ajax({
              url: 'http://127.0.0.1/TCC/webservice.php',
              method: "POST",
               data: {"tipo" : "atualizarkm", "id" : id, "km" : kmg},
              success: function(data) {
                var id = getUrlVars()["id"];
                $.ajax({
              url: 'http://127.0.0.1/TCC/webservice.php',
              method: "POST",
              data: {"tipo" : "listakm", "id" : id},
              success: function(data) {                                   
                 var json = $.parseJSON(data);
                 $("#kminicial").val(json.KmVeiculo +' Km');                               
              },              
              timeout: 3000,    
              error: function(){
              alert("Erro ao fazer a requisição");
                }              
              });          
              },              
              timeout: 3000,    
              error: function(){
          alert("Erro ao fazer a requisição");
          }              
    });
         $('#texto').hide();
         $('#btnat').hide();
         $("#kmfinal").val("");
         
         $("#alert").css("display","block");

         $('#alert').addClass('animated bounceIn');
         setTimeout(function() {$('#alert').removeClass('animated bounceIn');}, 1000);
         setTimeout(function() {$("#alert").css("display","none");}, 2500);
         });
        $("#btntela").click(function(){
         var valor = getUrlVars()["id"];
         window.location.href = "listagem.html?id="+valor;
       });

</script>
<footer class="bg-danger" style="height: 5rem!important;padding: 1rem">
      <div class="container">
      <div class="row">
	<div class="col md-6">
          <a class="bg-danger" id="pagatualizar" style="border-style:fixed;border-radius: 1rem;"><center><strong style="color:white;font-size: 2rem;"><i class="fas fa-edit"></i></strong><br>
            <strong style="color:white;font-size:0.8rem;">Atualizar</strong></center>
          </a></div>
          <div class="col md-0 " style="">
          </div>
          
          <div class="col md-6"><center><a class="bg-danger" id="listagem" style="border-radius: 1rem;">
            <center><strong style="color:white;font-size: 2rem;"><i class="fas fa-wrench"></i></strong><br>
            <strong style="color:white;font-size:0.8rem;">Consulta</strong></center>
          </center></a></div>
        </div> 
    </div>
  </footer>
  <script type="text/javascript">
/*
  var largura, altura;

  $(document).ready(function(){

  	altura = $(window).height();
  	largura = $(window).width();

  });
*/
  $("#listagem").click(function() {
            $('#atualizar').fadeOut('fast',function(){
            $('#listar').fadeIn('fast');
            });  
          //setTimeout(function() {$("#atualizar").css("display","none");},200);
          
           // setTimeout(function() {$("#listar").css("display","block");},500);
          // $('#listar').show();          
             
        });
  $("#pagatualizar").click(function() {
  	$('#listar').slideUp('fast',function(){
           	$('#atualizar').slideDown('fast');
           });
            // $('#listar').hide();  
          // setTimeout(function() {$("#listar").css("display","none");},200);
          
          // setTimeout(function() {$("#atualizar").css("display","block");},500);
          // $('#atualizar').show();                    
          

        });
  </script>
</body>
</html>